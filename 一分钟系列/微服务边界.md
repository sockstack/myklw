# 问题

> Q: 叔 这微服务 都上怎么拆服务的呀  最近一个同事老说边界在哪里  边界在哪里  搞不懂说的啥?


# 拆分原则

## 有几个基本的标准

1、数据 是否独立

```
举个栗子
   譬如 服务A 和服务B。 都调用同一张表做操作。 那说明边界不清晰
正确的是
   譬如商品服务调用用户服务。  那么 商品服务调用的就是商品表。 需要用户数据了，就应该去用户服务通过http api的方式调用。  而不是也去取用户表
```

2、服务共性拆分

```

举个栗子

商品服务  需要调用 订单表 来显示逼格排行

用户服务 需要调用 订单表 来显示 有钱大佬的排行


那么 tmd 就应该把订单 专门拉一个服务出来。 大家都去调这个服务。

```

3、并发和运行边界

```

譬如我有个功能是 商品列表和新闻列表。 一开始两个做在一起的。

结果tmd商品列表流量高的一批。 新闻都没人看 。 那么 我们应该把商品和新闻分开。 商品服务用3台服务器来负载均衡
新闻服务一个服务器胡乱搞搞就行了。反正没几个人看。老板又不愿意砍掉，神经病一样

```

4、数据拆分

```

用了微服务 ，也意味着 我们的数据 很可能也是分布式部署的 

譬如A服务调用商品数据。 B服务调用库存数据

假设我们有4台服务器。 分别部署了 4个的服务。 就是用来获取商品库存的。

那么其实 4台服务器，分别都有 商品的库存存储。 此时就要用到集群。 4个服务调用的不是同一个数据库。 而是各个服务器都有

```

```
譬如秒杀也是。  秒杀 存储库存用的是etcd（zookeeper）
一旦A服务器 把A自己的key减掉了。  由于数据一致性原则。 B、c、d服务器会同时减掉
秒杀压力大 。访问不可能都在一个服务器上。  会分流在不同的服务器上
如果tmd此时 用的是同一个数据库， 那还分流个屁
所以是 各自调用各自的etcd 

各个etcd组成一个集群

秒杀开始。 有个程序先从 数据库取出库存，直接扣掉

然后在 把数据存入etcd里。（由于集群，所以各个服务器 的etcd会同时拥有一样的数据）

这就是  为什么要使用集群 的 其中一个原因

为了保证服务微服务式部署、高可用等 。此时就要用 docker swarm或k8s来保证
不过这些需要运维保障

总不能10台服务器  我们一个个手工部署。出现问题 一个个手工重启

此时 类似服务器性能监控、链路监控 等 手段都要上
各个服务的管理和集中注册 需要 注册中心

服务和服务之间 会存在链式调用

譬如用户下单 。  流程是 扣存款->生成订单->通知用户

这是有3个服务组成。 那么其中一步出错了，咋办  。 此时要设定相应的降级和熔断机制

然后是 一旦下单成功， 难道tmd立刻同步通知用户吗？
肯定不行，需要mq来延迟推送消息。 

以及其他流程 都需要 异步的异步，同步的同步

这里面都需要用到MQ 这就是微服务里面的消息总线

这里面的整个架构 不是一蹴而就的 

而是通过系统运行、赚钱   长期一步步积累出来的

还是那句话。 在系统还没上线之前，睡也预料不到 后面 会产生什么情况

小公司也不可能 所有架构都上上去（倒闭了就）

微服务里面 每增加一个组件 每增加一个 手段 每拆分一个服务。 就会增加一份运维成本
就可能需要增加几台服务器， 增加一个人手
所以。 大家别把微服务想得 这么简单。 仿佛只要 拼凑拼凑组件就行了
```